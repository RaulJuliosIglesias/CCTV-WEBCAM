# ğŸ“¹ RTSP to Virtual Camera - Technical Specification
## Open Source Project for Windows PTZ Camera Virtualization

> **Project Goal**: Create a simple, lightweight desktop application that allows users to connect to Hikvision PTZ cameras (or any RTSP stream) and virtualize them as webcams for use in Google Meet, Zoom, Teams, and other video conferencing applications.

---

## ğŸ“‹ Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Tech Stack Decision](#2-tech-stack-decision)
3. [Final Recommended Stack](#3-final-recommended-stack)
4. [Project Architecture](#4-project-architecture)
5. [Project Structure](#5-project-structure)
6. [User Journey & Flow](#6-user-journey--flow)
7. [UI/UX Specification](#7-uiux-specification)
8. [Core Pipeline & Workflow](#8-core-pipeline--workflow)
9. [API & Dependencies Reference](#9-api--dependencies-reference)
10. [Windows Virtual Camera Implementation](#10-windows-virtual-camera-implementation)
11. [Feature Roadmap](#11-feature-roadmap)
12. [Installation & Build Instructions](#12-installation--build-instructions)
13. [Configuration Files](#13-configuration-files)
14. [Error Handling & Edge Cases](#14-error-handling--edge-cases)
15. [Testing Strategy](#15-testing-strategy)

---

## 1. Executive Summary

### Problem Statement
Users with Hikvision PTZ cameras (or similar IP cameras) want to use them as webcams in video conferencing apps. Currently, this requires complex setup with OBS or specialized software.

### Solution
A lightweight, open-source Windows application that:
- Connects to any RTSP stream
- Virtualizes it as a Windows camera device
- Works with Meet, Zoom, Teams without additional drivers (Windows 11) or with a one-time setup (Windows 10)

### Key Design Principles
- **Zero or Minimal Installation**: Leverage Windows 11 native `MFCreateVirtualCamera` API
- **Simple UX**: Just paste RTSP URL â†’ Click "Virtualize" â†’ Done
- **Lightweight**: Small binary, minimal dependencies
- **Open Source**: MIT or Apache 2.0 license

---

## 2. Tech Stack Decision

### Original Proposed Stack Analysis

| Component | Proposed | Verdict | Notes |
|-----------|----------|---------|-------|
| Language/UI | C# .NET 8 + WPF | âœ… Good | Native Windows, good tooling |
| RTSP Ingest | FFmpeg | âœ… Good | Industry standard |
| Virtual Cam | MFCreateVirtualCamera | âœ… Good | Win11 native, no drivers |

### Alternative Stacks Considered

#### Option A: Python + PyQt5 + pyvirtualcam
- **Pros**: Faster development, cross-platform potential
- **Cons**: Requires OBS installed, larger bundle, Python runtime
- **Reference**: github.com/dabulina/RTSP_to_VirtualCam (existing implementation)
- **Verdict**: âŒ Requires OBS or Unity Capture pre-installed

#### Option B: Electron + FFmpeg
- **Pros**: Web technologies, modern UI
- **Cons**: Large bundle (~150MB), memory heavy, still needs virtual cam driver
- **Verdict**: âŒ Too heavy for this use case

#### Option C: Tauri + Rust
- **Pros**: Small bundle, modern UI (React/Vue), Rust performance
- **Cons**: Complex FFmpeg integration, learning curve
- **Verdict**: âš ï¸ Good but over-engineered for Windows-only app

#### Option D: .NET 8 + WinUI 3 (Modern WPF)
- **Pros**: Native Windows, modern Fluent UI, single-file exe, .NET 8 performance
- **Cons**: Windows 10+ only, slightly newer ecosystem
- **Verdict**: âœ… **RECOMMENDED** for modern Windows apps

---

## 3. Final Recommended Stack

### Primary Stack (Windows 11 Focus)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RTSP VirtualCam                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI Layer           â”‚  .NET 8 + WinUI 3 (Fluent Design)    â”‚
â”‚  RTSP Client        â”‚  FFmpeg via FFmpeg.AutoGen            â”‚
â”‚  Frame Processing   â”‚  DirectX 11 / Direct2D (GPU accel)   â”‚
â”‚  Virtual Camera     â”‚  MFCreateVirtualCamera (Win11 API)   â”‚
â”‚  Build/Package      â”‚  Single-file self-contained exe       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Simplified Alternative Stack (Easier Development)

For faster implementation, use this stack:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RTSP VirtualCam (Simple)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI Layer           â”‚  .NET 8 + WPF (XAML)                  â”‚
â”‚  RTSP Client        â”‚  LibVLCSharp (VLC as library)        â”‚
â”‚  Virtual Camera     â”‚  VCamNetSample as base                â”‚
â”‚  Build/Package      â”‚  Single-file self-contained exe       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Stack Details

| Component | Technology | Version | Purpose |
|-----------|------------|---------|---------|
| Runtime | .NET 8 | 8.0+ | Cross-platform .NET runtime |
| UI Framework | WPF or WinUI 3 | Latest | Native Windows UI |
| RTSP Decoding | LibVLCSharp | 3.8+ | VLC as library (easier than FFmpeg) |
| OR RTSP Decoding | FFmpeg.AutoGen | 7.0+ | FFmpeg bindings (more control) |
| Virtual Camera | DirectN | Latest | MF Virtual Camera interop |
| Logging | Serilog | 4.0+ | Structured logging |
| Settings | System.Text.Json | Built-in | JSON config storage |

---

## 4. Project Architecture

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         User Interface                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  URL Input â”‚  â”‚   Preview   â”‚  â”‚   Controls   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚        â”‚                â”‚                  â”‚                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â–¼                â–¼                  â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                    Application Core                       â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚  â”‚ RTSP Client  â”‚â†’ â”‚ Frame Buffer â”‚â†’ â”‚ Virtual Camera â”‚ â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              Windows Media Foundation                     â”‚     â”‚
â”‚  â”‚  MFCreateVirtualCamera â†’ Frame Server â†’ Camera Device     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚            Video Conferencing Applications               â”‚     â”‚
â”‚  â”‚         Zoom  â”‚  Teams  â”‚  Meet  â”‚  OBS  â”‚  etc.        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Component Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          RTSPVirtualCam.exe                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Views Layer   â”‚    â”‚  ViewModel Layer â”‚    â”‚   Model Layer   â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚                  â”‚    â”‚                 â”‚ â”‚
â”‚  â”‚  MainWindow     â”‚â†â”€â”€â–¶â”‚  MainViewModel   â”‚â†â”€â”€â–¶â”‚  RtspClient     â”‚ â”‚
â”‚  â”‚  SettingsPage   â”‚    â”‚  SettingsVM      â”‚    â”‚  VirtualCam     â”‚ â”‚
â”‚  â”‚  PreviewPanel   â”‚    â”‚  ConnectionVM    â”‚    â”‚  FrameProcessor â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚                  â”‚    â”‚  ConfigStore    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                      â”‚                      â”‚          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                  â”‚                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚      Native Interop       â”‚                   â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                   â”‚
â”‚                    â”‚  â”‚ DirectN  â”‚ â”‚ FFmpeg â”‚  â”‚                   â”‚
â”‚                    â”‚  â”‚ (MF API) â”‚ â”‚ Interopâ”‚  â”‚                   â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Project Structure

```
RTSPVirtualCam/
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”œâ”€â”€ build.yml              # CI/CD pipeline
â”‚   â”‚   â””â”€â”€ release.yml            # Auto-release on tags
â”‚   â””â”€â”€ ISSUE_TEMPLATE/
â”‚       â””â”€â”€ bug_report.md
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ RTSPVirtualCam/            # Main application
â”‚   â”‚   â”œâ”€â”€ App.xaml               # WPF Application entry
â”‚   â”‚   â”œâ”€â”€ App.xaml.cs
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Views/                 # XAML UI views
â”‚   â”‚   â”‚   â”œâ”€â”€ MainWindow.xaml
â”‚   â”‚   â”‚   â”œâ”€â”€ MainWindow.xaml.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ SettingsWindow.xaml
â”‚   â”‚   â”‚   â””â”€â”€ Components/
â”‚   â”‚   â”‚       â”œâ”€â”€ ConnectionPanel.xaml
â”‚   â”‚   â”‚       â”œâ”€â”€ PreviewPanel.xaml
â”‚   â”‚   â”‚       â””â”€â”€ StatusBar.xaml
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ViewModels/            # MVVM ViewModels
â”‚   â”‚   â”‚   â”œâ”€â”€ MainViewModel.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ SettingsViewModel.cs
â”‚   â”‚   â”‚   â””â”€â”€ Base/
â”‚   â”‚   â”‚       â”œâ”€â”€ ViewModelBase.cs
â”‚   â”‚   â”‚       â””â”€â”€ RelayCommand.cs
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Models/                # Data models
â”‚   â”‚   â”‚   â”œâ”€â”€ ConnectionInfo.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ CameraSettings.cs
â”‚   â”‚   â”‚   â””â”€â”€ AppSettings.cs
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Services/              # Business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ IRtspService.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ RtspService.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ IVirtualCameraService.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ VirtualCameraService.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ ISettingsService.cs
â”‚   â”‚   â”‚   â””â”€â”€ SettingsService.cs
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Core/                  # Core functionality
â”‚   â”‚   â”‚   â”œâ”€â”€ RtspClient.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ FrameBuffer.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ FrameProcessor.cs
â”‚   â”‚   â”‚   â””â”€â”€ VirtualCamera/
â”‚   â”‚   â”‚       â”œâ”€â”€ VCamMediaSource.cs
â”‚   â”‚   â”‚       â”œâ”€â”€ VCamStream.cs
â”‚   â”‚   â”‚       â””â”€â”€ VCamController.cs
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Helpers/               # Utility classes
â”‚   â”‚   â”‚   â”œâ”€â”€ RtspUrlParser.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ FrameConverter.cs
â”‚   â”‚   â”‚   â””â”€â”€ DiagnosticLogger.cs
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Resources/             # Assets
â”‚   â”‚   â”‚   â”œâ”€â”€ Styles/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Colors.xaml
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Controls.xaml
â”‚   â”‚   â”‚   â”œâ”€â”€ Icons/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app.ico
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ camera.svg
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ connected.svg
â”‚   â”‚   â”‚   â””â”€â”€ TestPatterns/
â”‚   â”‚   â”‚       â””â”€â”€ no_signal.png
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ RTSPVirtualCam.csproj
â”‚   â”‚
â”‚   â””â”€â”€ RTSPVirtualCam.VCamSource/ # Virtual Camera COM component
â”‚       â”œâ”€â”€ MediaSource.cs
â”‚       â”œâ”€â”€ MediaStream.cs
â”‚       â”œâ”€â”€ FrameGenerator.cs
â”‚       â””â”€â”€ RTSPVirtualCam.VCamSource.csproj
â”‚
â”œâ”€â”€ libs/                          # Native dependencies
â”‚   â”œâ”€â”€ ffmpeg/
â”‚   â”‚   â””â”€â”€ win-x64/
â”‚   â”‚       â”œâ”€â”€ avcodec-60.dll
â”‚   â”‚       â”œâ”€â”€ avformat-60.dll
â”‚   â”‚       â””â”€â”€ avutil-58.dll
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ RTSPVirtualCam.Tests/
â”‚   â”‚   â”œâ”€â”€ RtspClientTests.cs
â”‚   â”‚   â”œâ”€â”€ FrameProcessorTests.cs
â”‚   â”‚   â””â”€â”€ VirtualCameraTests.cs
â”‚   â””â”€â”€ RTSPVirtualCam.IntegrationTests/
â”‚       â””â”€â”€ EndToEndTests.cs
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ INSTALLATION.md
â”‚   â”œâ”€â”€ USER_GUIDE.md
â”‚   â”œâ”€â”€ DEVELOPMENT.md
â”‚   â””â”€â”€ TROUBLESHOOTING.md
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ download-ffmpeg.ps1       # Download FFmpeg binaries
â”‚   â”œâ”€â”€ register-vcam.ps1         # Register virtual camera (admin)
â”‚   â””â”€â”€ build-release.ps1         # Build release package
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ RTSPVirtualCam.sln
â””â”€â”€ Directory.Build.props
```

---

## 6. User Journey & Flow

### Primary User Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER JOURNEY                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1. LAUNCH APP                                                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚     â”‚  User double-clicks RTSPVirtualCam    â”‚                        â”‚
â”‚     â”‚  â†’ App opens (no installation)        â”‚                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                         â”‚                                            â”‚
â”‚                         â–¼                                            â”‚
â”‚  2. ENTER RTSP URL                                                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚     â”‚  User pastes RTSP URL:                â”‚                        â”‚
â”‚     â”‚  rtsp://admin:pass@192.168.1.100/     â”‚                        â”‚
â”‚     â”‚  Streaming/Channels/101               â”‚                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                         â”‚                                            â”‚
â”‚                         â–¼                                            â”‚
â”‚  3. PREVIEW (OPTIONAL)                                               â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚     â”‚  User clicks "Preview" button         â”‚                        â”‚
â”‚     â”‚  â†’ Live preview shows in app          â”‚                        â”‚
â”‚     â”‚  â†’ User verifies camera working       â”‚                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                         â”‚                                            â”‚
â”‚                         â–¼                                            â”‚
â”‚  4. VIRTUALIZE                                                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚     â”‚  User clicks "Virtualize" button      â”‚                        â”‚
â”‚     â”‚  â†’ Virtual camera created             â”‚                        â”‚
â”‚     â”‚  â†’ Status: "Camera Active"            â”‚                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                         â”‚                                            â”‚
â”‚                         â–¼                                            â”‚
â”‚  5. USE IN VIDEO CALL                                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚     â”‚  User opens Zoom/Meet/Teams           â”‚                        â”‚
â”‚     â”‚  â†’ Selects "RTSP VirtualCam"          â”‚                        â”‚
â”‚     â”‚  â†’ PTZ camera now visible as webcam   â”‚                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                         â”‚                                            â”‚
â”‚                         â–¼                                            â”‚
â”‚  6. STOP                                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚     â”‚  User clicks "Stop" or closes app     â”‚                        â”‚
â”‚     â”‚  â†’ Virtual camera removed             â”‚                        â”‚
â”‚     â”‚  â†’ Resources freed                    â”‚                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### First-Time Setup Flow (Windows 11)

```
First Launch:
1. App detects first run
2. Shows welcome message
3. Requests camera access permission (if needed)
4. Ready to use (no installation required!)
```

### First-Time Setup Flow (Windows 10 - Optional Support)

```
First Launch (Win10):
1. App detects Windows 10
2. Shows "First-Time Setup Required" dialog
3. Guides user through DirectShow driver installation
   - One-click installer included
   - Requires admin rights
4. Restart prompt (optional)
5. Ready to use
```

---

## 7. UI/UX Specification

### Main Window Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—â”‚
â”‚ â•‘  ğŸ¥ RTSP VirtualCam                              â”€  â–¡  âœ•        â•‘â”‚
â”‚ â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£â”‚
â”‚ â•‘                                                                  â•‘â”‚
â”‚ â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘â”‚
â”‚ â•‘  â”‚                                                          â”‚   â•‘â”‚
â”‚ â•‘  â”‚                                                          â”‚   â•‘â”‚
â”‚ â•‘  â”‚                                                          â”‚   â•‘â”‚
â”‚ â•‘  â”‚                    PREVIEW AREA                          â”‚   â•‘â”‚
â”‚ â•‘  â”‚                                                          â”‚   â•‘â”‚
â”‚ â•‘  â”‚              (16:9 aspect ratio)                         â”‚   â•‘â”‚
â”‚ â•‘  â”‚                                                          â”‚   â•‘â”‚
â”‚ â•‘  â”‚         Shows "No Signal" or live preview                â”‚   â•‘â”‚
â”‚ â•‘  â”‚                                                          â”‚   â•‘â”‚
â”‚ â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘â”‚
â”‚ â•‘                                                                  â•‘â”‚
â”‚ â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘â”‚
â”‚ â•‘  â”‚ RTSP URL                                                 â”‚   â•‘â”‚
â”‚ â•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â•‘â”‚
â”‚ â•‘  â”‚ â”‚ rtsp://admin:password@192.168.1.100/Streaming/Ch101  â”‚ â”‚   â•‘â”‚
â”‚ â•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â•‘â”‚
â”‚ â•‘  â”‚                                                          â”‚   â•‘â”‚
â”‚ â•‘  â”‚    [â–¶ Preview]    [ğŸ“¹ Virtualize]    [â¹ Stop]    [âš™]   â”‚   â•‘â”‚
â”‚ â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘â”‚
â”‚ â•‘                                                                  â•‘â”‚
â”‚ â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£â”‚
â”‚ â•‘  â— Connected â”‚ 1920x1080 â”‚ 30 fps â”‚ H.264 â”‚ TCP                  â•‘â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### UI States

#### State 1: Disconnected (Initial)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [No Signal Image]           â”‚
â”‚                                     â”‚
â”‚   Enter RTSP URL to get started     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ Preview ] [ Virtualize (disabled) ] [ Stop (disabled) ]

â—‹ Disconnected â”‚ -- â”‚ -- â”‚ -- â”‚ --
```

#### State 2: Connecting
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚         â— Connecting...             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ Preview (disabled) ] [ Cancel ] 

â— Connecting to rtsp://192.168.1.100...
```

#### State 3: Preview Active
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [Live Camera Feed]          â”‚
â”‚                                     â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ â¹ Stop Preview ] [ ğŸ“¹ Virtualize ] 

â— Connected â”‚ 1920x1080 â”‚ 30 fps â”‚ H.264 â”‚ TCP
```

#### State 4: Virtualized
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [Live Camera Feed]          â”‚
â”‚                                     â”‚
â”‚    ğŸŸ¢ Camera: "RTSP VirtualCam"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ â¹ Stop Virtualization ]

â— Virtual Camera Active â”‚ 1920x1080 â”‚ 30 fps
```

### Color Scheme

```css
/* Light Theme (Windows Default) */
--background: #FAFAFA;
--surface: #FFFFFF;
--primary: #0078D4;          /* Windows Blue */
--success: #107C10;          /* Connected Green */
--error: #D13438;            /* Error Red */
--warning: #FFB900;          /* Warning Yellow */
--text-primary: #1A1A1A;
--text-secondary: #666666;
--border: #E1E1E1;

/* Dark Theme */
--background: #1F1F1F;
--surface: #2D2D2D;
--primary: #60CDFF;
--text-primary: #FFFFFF;
--text-secondary: #B3B3B3;
--border: #3D3D3D;
```

### Settings Window

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Settings                                              âœ•     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  General                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [ ] Start minimized to system tray                         â”‚
â”‚  [ ] Start with Windows                                     â”‚
â”‚  [ ] Remember last RTSP URL                                 â”‚
â”‚                                                             â”‚
â”‚  Stream                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Transport:  (â—) TCP   ( ) UDP                              â”‚
â”‚  Timeout:    [30   ] seconds                                â”‚
â”‚  [ ] Auto-reconnect on disconnect                           â”‚
â”‚                                                             â”‚
â”‚  Virtual Camera                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Camera Name: [RTSP VirtualCam            ]                 â”‚
â”‚  Resolution:  [â—‹ Auto] [ ] 1920x1080 [ ] 1280x720           â”‚
â”‚  Frame Rate:  [30 â–¼] fps                                    â”‚
â”‚                                                             â”‚
â”‚  Recent URLs                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ rtsp://admin:***@192.168.1.100/...        [ğŸ—‘]           â”‚
â”‚  â€¢ rtsp://user:***@10.0.0.50/...             [ğŸ—‘]           â”‚
â”‚                                                             â”‚
â”‚                              [ Cancel ]  [ Save ]           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Core Pipeline & Workflow

### Data Flow Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA FLOW PIPELINE                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RTSP Camera (Hikvision PTZ)
      â”‚
      â”‚ RTSP/TCP or RTSP/UDP
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. RTSP CLIENT (FFmpeg/LibVLC)                                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ â€¢ Establish RTSP session (DESCRIBE, SETUP, PLAY)             â”‚  â”‚
â”‚    â”‚ â€¢ Receive RTP packets                                        â”‚  â”‚
â”‚    â”‚ â€¢ Demux video stream                                         â”‚  â”‚
â”‚    â”‚ â€¢ Handle reconnection                                        â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â”‚ Encoded frames (H.264/H.265)
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. VIDEO DECODER (Hardware or Software)                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ â€¢ Decode H.264/H.265 to raw frames                           â”‚  â”‚
â”‚    â”‚ â€¢ Prefer hardware decode (DXVA2, CUDA, QuickSync)            â”‚  â”‚
â”‚    â”‚ â€¢ Fallback to software decode                                â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â”‚ Raw frames (YUV420)
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. FRAME PROCESSOR                                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ â€¢ Convert YUV420 â†’ NV12 or RGB32 (for MF Virtual Camera)     â”‚  â”‚
â”‚    â”‚ â€¢ Scale if needed (maintain aspect ratio)                    â”‚  â”‚
â”‚    â”‚ â€¢ Apply any transformations (flip, rotate)                   â”‚  â”‚
â”‚    â”‚ â€¢ Double-buffer for smooth delivery                          â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â”‚ NV12/RGB32 frames
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. FRAME BUFFER (Ring Buffer)                                        â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ â€¢ Thread-safe frame queue (3-5 frames)                       â”‚  â”‚
â”‚    â”‚ â€¢ Handles timing/synchronization                             â”‚  â”‚
â”‚    â”‚ â€¢ Drops frames if consumer is slow                           â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â”‚ Synchronized frames
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. VIRTUAL CAMERA MEDIA SOURCE                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ â€¢ IMFMediaSource implementation                              â”‚  â”‚
â”‚    â”‚ â€¢ Provides frames on-demand to Frame Server                  â”‚  â”‚
â”‚    â”‚ â€¢ Registers via MFCreateVirtualCamera                        â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â”‚ MF Samples
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. WINDOWS FRAME SERVER (System Service)                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ â€¢ System service that manages virtual cameras                â”‚  â”‚
â”‚    â”‚ â€¢ Distributes frames to all requesting applications          â”‚  â”‚
â”‚    â”‚ â€¢ Handles permissions and access control                     â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. VIDEO CONFERENCING APPS                                           â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚   Zoom    â”‚  â”‚   Teams   â”‚  â”‚   Meet    â”‚  â”‚    OBS    â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Threading Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         THREADING MODEL                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MAIN THREAD (UI Thread)                                              â”‚
â”‚ â€¢ WPF Dispatcher                                                     â”‚
â”‚ â€¢ User input handling                                                â”‚
â”‚ â€¢ UI updates                                                         â”‚
â”‚ â€¢ Preview display                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Commands/Events
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RTSP THREAD (Background Worker)                                      â”‚
â”‚ â€¢ RTSP connection management                                         â”‚
â”‚ â€¢ Packet reception                                                   â”‚
â”‚ â€¢ Frame decoding                                                     â”‚
â”‚ â€¢ Pushes to Frame Buffer                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Thread-safe Queue
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRAME BUFFER (Shared Memory)                                         â”‚
â”‚ â€¢ Lock-free ring buffer                                              â”‚
â”‚ â€¢ 3-5 frame capacity                                                 â”‚
â”‚ â€¢ Automatic frame dropping                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ On-demand pull
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VIRTUAL CAMERA THREAD (Frame Server Callback)                        â”‚
â”‚ â€¢ Called by Windows Frame Server                                     â”‚
â”‚ â€¢ Pulls frames from buffer                                           â”‚
â”‚ â€¢ Returns MF samples                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. API & Dependencies Reference

### NuGet Packages

```xml
<!-- RTSPVirtualCam.csproj -->
<ItemGroup>
  <!-- UI Framework -->
  <PackageReference Include="CommunityToolkit.Mvvm" Version="8.2.2" />
  
  <!-- RTSP/Video (Option A: LibVLC - easier) -->
  <PackageReference Include="LibVLCSharp" Version="3.8.5" />
  <PackageReference Include="VideoLAN.LibVLC.Windows" Version="3.0.20" />
  
  <!-- RTSP/Video (Option B: FFmpeg - more control) -->
  <PackageReference Include="FFmpeg.AutoGen" Version="7.0.0" />
  
  <!-- Media Foundation Interop -->
  <PackageReference Include="DirectN" Version="2024.6.26.1" />
  
  <!-- Logging -->
  <PackageReference Include="Serilog" Version="4.0.0" />
  <PackageReference Include="Serilog.Sinks.File" Version="5.0.0" />
  
  <!-- JSON Settings -->
  <PackageReference Include="System.Text.Json" Version="8.0.4" />
</ItemGroup>
```

### Windows APIs Used

| API | Purpose | Documentation |
|-----|---------|---------------|
| `MFCreateVirtualCamera` | Create virtual camera | [Microsoft Docs](https://learn.microsoft.com/en-us/windows/win32/api/mfvirtualcamera/nf-mfvirtualcamera-mfcreatevirtualcamera) |
| `IMFVirtualCamera` | Virtual camera interface | Win11 SDK |
| `IMFMediaSource` | Custom media source | Media Foundation |
| `IMFMediaStream` | Provide video frames | Media Foundation |

### RTSP URL Format (Hikvision)

```
Main Stream:
rtsp://<username>:<password>@<ip>:<port>/Streaming/Channels/101

Sub Stream:  
rtsp://<username>:<password>@<ip>:<port>/Streaming/Channels/102

With specific codec:
rtsp://<username>:<password>@<ip>:<port>/ISAPI/Streaming/channels/101

Common ports: 554 (default), 8554
Common users: admin
```

### Reference Implementations

| Repository | Purpose | URL |
|------------|---------|-----|
| VCamNetSample | .NET MF Virtual Camera | github.com/smourier/VCamNetSample |
| VCamSample | C++ MF Virtual Camera | github.com/smourier/VCamSample |
| RTSP_to_VirtualCam | Python reference | github.com/dabulina/RTSP_to_VirtualCam |

---

## 10. Windows Virtual Camera Implementation

### MFCreateVirtualCamera Usage

```csharp
// Simplified example - see VCamNetSample for full implementation

public class VirtualCameraController
{
    private IMFVirtualCamera? _virtualCamera;
    
    public async Task StartAsync(string cameraName)
    {
        // Create virtual camera (Windows 11 only)
        var result = MFCreateVirtualCamera(
            type: MFVirtualCameraType.SoftwareCameraSource,
            lifetime: MFVirtualCameraLifetime.Session,  // Removed when app closes
            access: MFVirtualCameraAccess.CurrentUser,
            friendlyName: cameraName,
            sourceId: "{YOUR-MEDIA-SOURCE-CLSID}",
            categories: null,
            categoryCount: 0,
            out _virtualCamera
        );
        
        if (result.Succeeded)
        {
            await _virtualCamera.Start();
        }
    }
    
    public async Task StopAsync()
    {
        if (_virtualCamera != null)
        {
            await _virtualCamera.Stop();
            _virtualCamera.Shutdown();
            _virtualCamera = null;
        }
    }
}
```

### Custom Media Source Requirements

The virtual camera requires a COM-registered Media Source that:

1. Implements `IMFMediaSource`
2. Provides `IMFMediaStream` with video frames
3. Supports NV12 or RGB32 pixel formats
4. Is registered in HKLM (requires admin for first registration)

### Frame Format Requirements

| Format | Pros | Cons |
|--------|------|------|
| NV12 | Preferred by most apps, GPU-friendly | Requires YUV conversion |
| RGB32 | Simple, no conversion from decoded | Higher bandwidth |

---

## 11. Feature Roadmap

### Phase 1: MVP (v1.0)
- [x] Basic UI with RTSP URL input
- [x] Connect to single RTSP stream
- [x] Preview in app
- [x] Create virtual camera (Win11)
- [x] Basic error handling
- [x] Single-file executable

### Phase 2: Enhanced (v1.1)
- [ ] URL history (last 10)
- [ ] Settings persistence
- [ ] Auto-reconnect on disconnect
- [ ] System tray support
- [ ] Dark mode

### Phase 3: Advanced (v1.2)
- [ ] Multiple simultaneous cameras
- [ ] PTZ control integration
- [ ] Hardware decode (DXVA2)
- [ ] Windows 10 support (DirectShow fallback)
- [ ] Installer with auto-registration

### Phase 4: Enterprise (v2.0)
- [ ] ONVIF discovery
- [ ] Authentication management
- [ ] Stream recording
- [ ] Multi-monitor support
- [ ] Command-line interface

---

## 12. Installation & Build Instructions

### Prerequisites

```powershell
# Install .NET 8 SDK
winget install Microsoft.DotNet.SDK.8

# Install Visual Studio 2022 (or VS Code with C# extension)
winget install Microsoft.VisualStudio.2022.Community
```

### Build from Source

```powershell
# Clone repository
git clone https://github.com/YOUR_USERNAME/RTSPVirtualCam.git
cd RTSPVirtualCam

# Restore dependencies
dotnet restore

# Build
dotnet build

# Run
dotnet run --project src/RTSPVirtualCam

# Publish single-file executable
dotnet publish src/RTSPVirtualCam -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true -o ./publish
```

### First Run (Admin Required Once)

```powershell
# Register virtual camera COM component (one-time, requires admin)
regsvr32 /s "RTSPVirtualCam.VCamSource.dll"

# Or use the included script
.\scripts\register-vcam.ps1
```

---

## 13. Configuration Files

### appsettings.json

```json
{
  "AppSettings": {
    "CameraName": "RTSP VirtualCam",
    "DefaultResolution": "auto",
    "DefaultFrameRate": 30,
    "Transport": "tcp",
    "TimeoutSeconds": 30,
    "AutoReconnect": true,
    "StartMinimized": false,
    "StartWithWindows": false,
    "RememberLastUrl": true,
    "MaxUrlHistory": 10,
    "Theme": "system"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information"
    },
    "File": {
      "Path": "logs/rtspvirtualcam.log",
      "MaxSizeMB": 10,
      "MaxFiles": 5
    }
  }
}
```

### urlhistory.json

```json
{
  "urls": [
    {
      "url": "rtsp://admin:***@192.168.1.100:554/Streaming/Channels/101",
      "displayName": "Office PTZ Camera",
      "lastUsed": "2024-01-15T10:30:00Z"
    }
  ]
}
```

---

## 14. Error Handling & Edge Cases

### Common Errors

| Error | Cause | Solution |
|-------|-------|----------|
| "Connection timeout" | Camera unreachable | Check network, IP, port |
| "Authentication failed" | Wrong credentials | Verify username/password |
| "Unsupported codec" | Camera uses unsupported format | Try different stream |
| "Virtual camera creation failed" | Win10 or missing registration | Run as admin, register COM |
| "Frame decode error" | Corrupted stream | Use TCP instead of UDP |

### Auto-Recovery Strategy

```csharp
public class ReconnectionPolicy
{
    public int MaxAttempts { get; set; } = 5;
    public int InitialDelayMs { get; set; } = 1000;
    public int MaxDelayMs { get; set; } = 30000;
    public double BackoffMultiplier { get; set; } = 2.0;
    
    public int GetDelay(int attempt)
    {
        var delay = InitialDelayMs * Math.Pow(BackoffMultiplier, attempt);
        return (int)Math.Min(delay, MaxDelayMs);
    }
}
```

---

## 15. Testing Strategy

### Unit Tests

```csharp
[TestClass]
public class RtspUrlParserTests
{
    [TestMethod]
    public void Parse_ValidUrl_ReturnsComponents()
    {
        var url = "rtsp://admin:pass@192.168.1.100:554/Streaming/Channels/101";
        var result = RtspUrlParser.Parse(url);
        
        Assert.AreEqual("admin", result.Username);
        Assert.AreEqual("192.168.1.100", result.Host);
        Assert.AreEqual(554, result.Port);
    }
}
```

### Integration Tests

```csharp
[TestClass]
public class EndToEndTests
{
    [TestMethod]
    public async Task ConnectAndVirtualize_RealCamera_Success()
    {
        // Requires actual RTSP camera on network
        var client = new RtspClient("rtsp://test:test@192.168.1.100/stream");
        await client.ConnectAsync();
        
        var vcam = new VirtualCameraController();
        await vcam.StartAsync("Test Camera");
        
        // Verify camera appears in system
        Assert.IsTrue(await CameraExists("Test Camera Windows Virtual Camera"));
        
        await vcam.StopAsync();
    }
}
```

---

## ğŸ“ Notes for AI Code Agent

### Priority Order

1. **Start with the VCamNetSample base** - Clone https://github.com/smourier/VCamNetSample as your virtual camera foundation
2. **Add LibVLCSharp for RTSP** - Easier than FFmpeg, handles all decoding
3. **Build simple WPF UI** - Use the layouts in Section 7
4. **Wire up the pipeline** - Connect VLC frames to virtual camera
5. **Add error handling and settings** - Polish for release

### Key Decisions Made

- **Windows 11 only for v1.0** - Simplifies virtual camera dramatically
- **LibVLCSharp over FFmpeg** - Much easier to integrate, battle-tested
- **WPF over WinUI 3** - More stable, better documentation
- **Session-based camera** - Auto-removed when app closes, no cleanup needed

### Files to Generate First

1. `RTSPVirtualCam.sln` - Solution file
2. `src/RTSPVirtualCam/RTSPVirtualCam.csproj` - Main project
3. `src/RTSPVirtualCam/App.xaml` - WPF application entry
4. `src/RTSPVirtualCam/Views/MainWindow.xaml` - Main UI
5. `src/RTSPVirtualCam/Core/RtspClient.cs` - RTSP handling
6. `src/RTSPVirtualCam/Core/VirtualCamera/VCamController.cs` - Virtual camera

---

## License

This specification is released under MIT License. The resulting software should use MIT or Apache 2.0 for maximum compatibility.

---

*Document Version: 1.0*
*Created: January 2026*
*For: Open Source RTSP Virtual Camera Project*
